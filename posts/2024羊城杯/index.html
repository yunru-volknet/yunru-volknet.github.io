<!doctype html>
<html lang="en">
  <head>
    <title> // yunru&#39;s blog</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.128.2">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="yunru" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/css/main.min.562871a81790ee61fbc41ddb89eacf3bc0967ee9bde46cf8764c66fe91f0e6fc.css" />
    

    
  


    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="yunru&#39;s blog">
  <meta name="twitter:description" content="2024羊城杯，这次学到了很多新东西，但是先知社区发晚了，就放这里了
#TH_curve ##题目
from Crypto.Util.number import * from secret import flag def add_THcurve(P, Q): if P == (0, 0): return Q if Q == (0, 0): return P x1, y1 = P x2, y2 = Q x3 = (x1 - y1 ** 2 * x2 * y2) * pow(a * x1 * y1 * x2 ** 2 - y2, -1, p) % p y3 = (y1 * y2 ** 2 - a * x1 ** 2 * x2) * pow(a * x1 * y1 * x2 ** 2 - y2, -1, p) % p return x3, y3 def mul_THcurve(n, P): R = (0, 0) while n &gt; 0: if n % 2 == 1: R = add_THcurve(R, P) P = add_THcurve(P, P) n = n // 2 return R p = 10297529403524403127640670200603184608844065065952536889 a = 2 G = (8879931045098533901543131944615620692971716807984752065, 4106024239449946134453673742202491320614591684229547464) FLAG = flag.">

    <meta property="og:url" content="https://yunru-volknet.github.io/posts/2024%E7%BE%8A%E5%9F%8E%E6%9D%AF/">
  <meta property="og:site_name" content="yunru&#39;s blog">
  <meta property="og:title" content="yunru&#39;s blog">
  <meta property="og:description" content="2024羊城杯，这次学到了很多新东西，但是先知社区发晚了，就放这里了
#TH_curve ##题目
from Crypto.Util.number import * from secret import flag def add_THcurve(P, Q): if P == (0, 0): return Q if Q == (0, 0): return P x1, y1 = P x2, y2 = Q x3 = (x1 - y1 ** 2 * x2 * y2) * pow(a * x1 * y1 * x2 ** 2 - y2, -1, p) % p y3 = (y1 * y2 ** 2 - a * x1 ** 2 * x2) * pow(a * x1 * y1 * x2 ** 2 - y2, -1, p) % p return x3, y3 def mul_THcurve(n, P): R = (0, 0) while n &gt; 0: if n % 2 == 1: R = add_THcurve(R, P) P = add_THcurve(P, P) n = n // 2 return R p = 10297529403524403127640670200603184608844065065952536889 a = 2 G = (8879931045098533901543131944615620692971716807984752065, 4106024239449946134453673742202491320614591684229547464) FLAG = flag.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">


  </head>
  <body>
    <header class="app-header">
      <a href="https://yunru-volknet.github.io/"><img class="app-header-avatar" src="/avatar.jpg" alt="yunru" /></a>
      <span class="app-header-title">yunru&#39;s blog</span>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/">主页</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/">标签</a>
             - 
          
          <a class="app-header-menu-item" href="/about/">About</a>
      </nav>
      <p>Knowledge is power.</p>
      <div class="app-header-social">
        
          <a href="https://github.com/gohugoio" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>Github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
          </a>
        
          <a href="https://twitter.com/gohugoio" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter">
  <title>Twitter</title>
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
</svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title"></h1>
      <div class="post-meta">
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Jan 1, 0001
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          9 min read
        </div>
      </div>
    </header>
    <div class="post-content">
      <p>2024羊城杯，这次学到了很多新东西，但是先知社区发晚了，就放这里了</p>
<p>#TH_curve
##题目</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> secret <span style="color:#f92672">import</span> flag
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_THcurve</span>(P, Q):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> P <span style="color:#f92672">==</span> (<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> Q
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> Q <span style="color:#f92672">==</span> (<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> P
</span></span><span style="display:flex;"><span>    x1, y1 <span style="color:#f92672">=</span> P
</span></span><span style="display:flex;"><span>    x2, y2 <span style="color:#f92672">=</span> Q
</span></span><span style="display:flex;"><span>    x3 <span style="color:#f92672">=</span> (x1 <span style="color:#f92672">-</span> y1 <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> x2 <span style="color:#f92672">*</span> y2) <span style="color:#f92672">*</span> pow(a <span style="color:#f92672">*</span> x1 <span style="color:#f92672">*</span> y1 <span style="color:#f92672">*</span> x2 <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> y2, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, p) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span>    y3 <span style="color:#f92672">=</span> (y1 <span style="color:#f92672">*</span> y2 <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> a <span style="color:#f92672">*</span> x1 <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> x2) <span style="color:#f92672">*</span> pow(a <span style="color:#f92672">*</span> x1 <span style="color:#f92672">*</span> y1 <span style="color:#f92672">*</span> x2 <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> y2, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, p) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> x3, y3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">mul_THcurve</span>(n, P):
</span></span><span style="display:flex;"><span>    R <span style="color:#f92672">=</span> (<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> n <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> n <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>            R <span style="color:#f92672">=</span> add_THcurve(R, P)
</span></span><span style="display:flex;"><span>        P <span style="color:#f92672">=</span> add_THcurve(P, P)
</span></span><span style="display:flex;"><span>        n <span style="color:#f92672">=</span> n <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> R
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">10297529403524403127640670200603184608844065065952536889</span>
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>G <span style="color:#f92672">=</span> (<span style="color:#ae81ff">8879931045098533901543131944615620692971716807984752065</span>, <span style="color:#ae81ff">4106024239449946134453673742202491320614591684229547464</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>FLAG <span style="color:#f92672">=</span> flag<span style="color:#f92672">.</span>lstrip(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;DASCTF{&#39;</span>)<span style="color:#f92672">.</span>rstrip(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;}&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">assert</span> len(FLAG) <span style="color:#f92672">==</span> <span style="color:#ae81ff">15</span>
</span></span><span style="display:flex;"><span>m <span style="color:#f92672">=</span> bytes_to_long(FLAG)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">assert</span> m <span style="color:#f92672">&lt;</span> p
</span></span><span style="display:flex;"><span>Q <span style="color:#f92672">=</span> mul_THcurve(m, G)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Q =&#34;</span>, Q)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Q = (6784278627340957151283066249316785477882888190582875173, 6078603759966354224428976716568980670702790051879661797)</span>
</span></span></code></pre></div><p>##分析
注意到</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_THcurve</span>(P, Q):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> P <span style="color:#f92672">==</span> (<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> Q
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> Q <span style="color:#f92672">==</span> (<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> P
</span></span><span style="display:flex;"><span>    x1, y1 <span style="color:#f92672">=</span> P
</span></span><span style="display:flex;"><span>    x2, y2 <span style="color:#f92672">=</span> Q
</span></span><span style="display:flex;"><span>    x3 <span style="color:#f92672">=</span> (x1 <span style="color:#f92672">-</span> y1 <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> x2 <span style="color:#f92672">*</span> y2) <span style="color:#f92672">*</span> pow(a <span style="color:#f92672">*</span> x1 <span style="color:#f92672">*</span> y1 <span style="color:#f92672">*</span> x2 <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> y2, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, p) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span>    y3 <span style="color:#f92672">=</span> (y1 <span style="color:#f92672">*</span> y2 <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> a <span style="color:#f92672">*</span> x1 <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> x2) <span style="color:#f92672">*</span> pow(a <span style="color:#f92672">*</span> x1 <span style="color:#f92672">*</span> y1 <span style="color:#f92672">*</span> x2 <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> y2, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, p) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> x3, y3
</span></span></code></pre></div><p>符合https://www.hyperelliptic.org/EFD/g1p/auto-twistedhessian.html 的定义
<del>而且题目确实叫th_curve</del>
得到式子如下：
a<em>x3+y3+1=d</em>x<em>y
a = 2已知，需要求的是d
2</em>x3+y3+1=d<em>x</em>y
把d带进去就是d = (2<em>x3+y3+1)/(x</em>y)
所以按照上面的文章里面所说的进行换元
x&rsquo;=X/Z
y&rsquo;=Y/Z
得到
a<em>x&rsquo;^3+y&rsquo;^3+z&rsquo;^3=d</em>x&rsquo;*y&rsquo;*z'</p>
<p>这样构造出了齐次式子之后就可以构造椭圆曲线了</p>
<p>构造完成之后就是ecdlp
听佬们说还有一种解法是把这个th_curve转换成Weierstrass型曲线（就是最常见的y^2 = x^3 + a*x + b）然后后面就一样了，有兴趣的师傅可以尝试一下
##exp</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">10297529403524403127640670200603184608844065065952536889</span>
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>P <span style="color:#f92672">=</span> (<span style="color:#ae81ff">8879931045098533901543131944615620692971716807984752065</span>, <span style="color:#ae81ff">4106024239449946134453673742202491320614591684229547464</span>)
</span></span><span style="display:flex;"><span>Q <span style="color:#f92672">=</span> (<span style="color:#ae81ff">6784278627340957151283066249316785477882888190582875173</span>, <span style="color:#ae81ff">6078603759966354224428976716568980670702790051879661797</span>)
</span></span><span style="display:flex;"><span>d <span style="color:#f92672">=</span> (a <span style="color:#f92672">*</span> Q[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">**</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span> Q[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">**</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> inverse(Q[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> Q[<span style="color:#ae81ff">1</span>], p) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>R<span style="color:#f92672">.&lt;</span>x,y,z<span style="color:#f92672">&gt;</span> <span style="color:#f92672">=</span> Zmod(p)[]
</span></span><span style="display:flex;"><span>cubic <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> x<span style="color:#f92672">^</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span> y<span style="color:#f92672">^</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">+</span> z<span style="color:#f92672">^</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">-</span> d<span style="color:#f92672">*</span>x<span style="color:#f92672">*</span>y<span style="color:#f92672">*</span>z
</span></span><span style="display:flex;"><span>E <span style="color:#f92672">=</span> EllipticCurve_from_cubic(cubic,morphism<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>P <span style="color:#f92672">=</span> E(P)
</span></span><span style="display:flex;"><span>Q <span style="color:#f92672">=</span> E(Q)
</span></span><span style="display:flex;"><span>P_ord <span style="color:#f92672">=</span> P<span style="color:#f92672">.</span>order()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">Pohlig_Hellman</span>(n,P,Q):
</span></span><span style="display:flex;"><span>    factors, exponents <span style="color:#f92672">=</span> zip(<span style="color:#f92672">*</span>factor(n))
</span></span><span style="display:flex;"><span>    primes <span style="color:#f92672">=</span> [factors[i] <span style="color:#f92672">^</span> exponents[i] <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(factors))][:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    print(primes)
</span></span><span style="display:flex;"><span>    dlogs <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> fac <span style="color:#f92672">in</span> primes:
</span></span><span style="display:flex;"><span>        t <span style="color:#f92672">=</span> int(int(P<span style="color:#f92672">.</span>order()) <span style="color:#f92672">//</span> int(fac))
</span></span><span style="display:flex;"><span>        dlog <span style="color:#f92672">=</span> discrete_log(t<span style="color:#f92672">*</span>Q,t<span style="color:#f92672">*</span>P,operation<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;+&#34;</span>)
</span></span><span style="display:flex;"><span>        dlogs <span style="color:#f92672">+=</span> [dlog]
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;factor: &#34;</span><span style="color:#f92672">+</span>str(fac)<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;, Discrete Log: &#34;</span><span style="color:#f92672">+</span>str(dlog)) <span style="color:#75715e">#calculates discrete logarithm for each prime order</span>
</span></span><span style="display:flex;"><span>    num2 <span style="color:#f92672">=</span> crt(dlogs,primes)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> num2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>num2 <span style="color:#f92672">=</span> Pohlig_Hellman(P_ord,P,Q)
</span></span><span style="display:flex;"><span>print(long_to_bytes(num2))
</span></span></code></pre></div><p>#babycruve
##题目</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env python</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -*- coding: UTF-8 -*-</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> hashlib
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sage.all <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Cipher <span style="color:#f92672">import</span> AES
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.Padding <span style="color:#f92672">import</span> pad
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> secret <span style="color:#f92672">import</span> c, b, key, FLAG
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_curve</span>(P, Q, K):
</span></span><span style="display:flex;"><span>    a, d, p <span style="color:#f92672">=</span> K
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> P <span style="color:#f92672">==</span> (<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> Q
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> Q <span style="color:#f92672">==</span> (<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> P
</span></span><span style="display:flex;"><span>    x1, y1 <span style="color:#f92672">=</span> P
</span></span><span style="display:flex;"><span>    x2, y2 <span style="color:#f92672">=</span> Q
</span></span><span style="display:flex;"><span>    x3 <span style="color:#f92672">=</span> (x1 <span style="color:#f92672">*</span> y2 <span style="color:#f92672">+</span> y1 <span style="color:#f92672">*</span> x2) <span style="color:#f92672">*</span> pow(<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> d <span style="color:#f92672">*</span> x1 <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> x2 <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, p) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span>    y3 <span style="color:#f92672">=</span> ((y1 <span style="color:#f92672">*</span> y2 <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> a <span style="color:#f92672">*</span> x1 <span style="color:#f92672">*</span> x2) <span style="color:#f92672">*</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> d <span style="color:#f92672">*</span> x1 <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> x2 <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> d <span style="color:#f92672">*</span> x1 <span style="color:#f92672">*</span> x2 <span style="color:#f92672">*</span> (x1 <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> x2 <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span>)) <span style="color:#f92672">*</span> pow(
</span></span><span style="display:flex;"><span>        (<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> d <span style="color:#f92672">*</span> x1 <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> x2 <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, p) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> x3, y3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">mul_curve</span>(n, P, K):
</span></span><span style="display:flex;"><span>    R <span style="color:#f92672">=</span> (<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> n <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> n <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>            R <span style="color:#f92672">=</span> add_curve(R, P, K)
</span></span><span style="display:flex;"><span>        P <span style="color:#f92672">=</span> add_curve(P, P, K)
</span></span><span style="display:flex;"><span>        n <span style="color:#f92672">=</span> n <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> R
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">AES_encrypt</span>(k):
</span></span><span style="display:flex;"><span>    key <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha256(str(k)<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>digest()[:<span style="color:#ae81ff">16</span>]
</span></span><span style="display:flex;"><span>    iv <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>urandom(<span style="color:#ae81ff">16</span>)
</span></span><span style="display:flex;"><span>    cipher <span style="color:#f92672">=</span> AES<span style="color:#f92672">.</span>new(key, AES<span style="color:#f92672">.</span>MODE_CBC, iv)
</span></span><span style="display:flex;"><span>    cipher <span style="color:#f92672">=</span> cipher<span style="color:#f92672">.</span>encrypt(pad(FLAG, <span style="color:#ae81ff">16</span>))
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>    data[<span style="color:#e6db74">&#34;iv&#34;</span>] <span style="color:#f92672">=</span> iv<span style="color:#f92672">.</span>hex()
</span></span><span style="display:flex;"><span>    data[<span style="color:#e6db74">&#34;cipher&#34;</span>] <span style="color:#f92672">=</span> cipher<span style="color:#f92672">.</span>hex()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a <span style="color:#f92672">=</span> <span style="color:#ae81ff">46</span>
</span></span><span style="display:flex;"><span>d <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>p1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">826100030683243954408990060837</span>
</span></span><span style="display:flex;"><span>K1 <span style="color:#f92672">=</span> (a, d, p1)
</span></span><span style="display:flex;"><span>G1 <span style="color:#f92672">=</span> (<span style="color:#ae81ff">560766116033078013304693968735</span>, <span style="color:#ae81ff">756416322956623525864568772142</span>)
</span></span><span style="display:flex;"><span>P1 <span style="color:#f92672">=</span> mul_curve(c, G1, K1)
</span></span><span style="display:flex;"><span>Q1 <span style="color:#f92672">=</span> mul_curve(b, G1, K1)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;P1 =&#34;</span>, P1)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Q1 =&#34;</span>, Q1)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># P1 = (528578510004630596855654721810, 639541632629313772609548040620)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Q1 = (819520958411405887240280598475, 76906957256966244725924513645)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">770311352827455849356512448287</span>
</span></span><span style="display:flex;"><span>E <span style="color:#f92672">=</span> EllipticCurve(GF(p), [<span style="color:#f92672">-</span>c, b])
</span></span><span style="display:flex;"><span>G <span style="color:#f92672">=</span> E<span style="color:#f92672">.</span>gens()[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>P <span style="color:#f92672">=</span> G <span style="color:#f92672">*</span> key
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">=</span> AES_encrypt(key)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;G =&#34;</span>, G)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;P =&#34;</span>, P)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;data =&#34;</span>,data)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># G = (584273268656071313022845392380 : 105970580903682721429154563816 : 1)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># P = (401055814681171318348566474726 : 293186309252428491012795616690 : 1)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># data = {&#39;iv&#39;: &#39;bae1b42f174443d009c8d3a1576f07d6&#39;, &#39;cipher&#39;: &#39;ff34da7a65854ed75342fd4ad178bf577bd622df9850a24fd63e1da557b4b8a4&#39;}</span>
</span></span></code></pre></div><p>##分析
b,c的数值并不大，可以直接爆破出来(或许有不那么暴力的方法，但是我没想到)
爆破完了之后就是dlp问题，直接dlog就可以得到k
然后把k套进去aes里面就得到了flag
##exp
爆破b,c</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>a <span style="color:#f92672">=</span> <span style="color:#ae81ff">46</span>
</span></span><span style="display:flex;"><span>d <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>p1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">826100030683243954408990060837</span>
</span></span><span style="display:flex;"><span>K1 <span style="color:#f92672">=</span> (a, d, p1)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>G1 <span style="color:#f92672">=</span> (<span style="color:#ae81ff">560766116033078013304693968735</span>, <span style="color:#ae81ff">756416322956623525864568772142</span>)
</span></span><span style="display:flex;"><span>P1 <span style="color:#f92672">=</span> (<span style="color:#ae81ff">528578510004630596855654721810</span>, <span style="color:#ae81ff">639541632629313772609548040620</span>)
</span></span><span style="display:flex;"><span>Q1 <span style="color:#f92672">=</span> (<span style="color:#ae81ff">819520958411405887240280598475</span>, <span style="color:#ae81ff">76906957256966244725924513645</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_curve</span>(P, Q, K):
</span></span><span style="display:flex;"><span>    a, d, p <span style="color:#f92672">=</span> K
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> P <span style="color:#f92672">==</span> (<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> Q
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> Q <span style="color:#f92672">==</span> (<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> P
</span></span><span style="display:flex;"><span>    x1, y1 <span style="color:#f92672">=</span> P
</span></span><span style="display:flex;"><span>    x2, y2 <span style="color:#f92672">=</span> Q
</span></span><span style="display:flex;"><span>    x3 <span style="color:#f92672">=</span> (x1 <span style="color:#f92672">*</span> y2 <span style="color:#f92672">+</span> y1 <span style="color:#f92672">*</span> x2) <span style="color:#f92672">*</span> pow(<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> d <span style="color:#f92672">*</span> x1 <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> x2 <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, p) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span>    y3 <span style="color:#f92672">=</span> ((y1 <span style="color:#f92672">*</span> y2 <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> a <span style="color:#f92672">*</span> x1 <span style="color:#f92672">*</span> x2) <span style="color:#f92672">*</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> d <span style="color:#f92672">*</span> x1 <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> x2 <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> d <span style="color:#f92672">*</span> x1 <span style="color:#f92672">*</span> x2 <span style="color:#f92672">*</span> (x1 <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> x2 <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span>)) <span style="color:#f92672">*</span> pow(
</span></span><span style="display:flex;"><span>        (<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> d <span style="color:#f92672">*</span> x1 <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> x2 <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, p) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> x3, y3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">mul_curve</span>(n, P, K):
</span></span><span style="display:flex;"><span>    R <span style="color:#f92672">=</span> (<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> n <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> n <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>            R <span style="color:#f92672">=</span> add_curve(R, P, K)
</span></span><span style="display:flex;"><span>        P <span style="color:#f92672">=</span> add_curve(P, P, K)
</span></span><span style="display:flex;"><span>        n <span style="color:#f92672">=</span> n <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> R
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">solve_for_scalars</span>(P1, Q1, G1, K1):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1000000</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> mul_curve(c, G1, K1) <span style="color:#f92672">==</span> P1:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> b <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1000000</span>):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> mul_curve(b, G1, K1) <span style="color:#f92672">==</span> Q1:
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> b, c
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>, <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>b, c <span style="color:#f92672">=</span> solve_for_scalars(P1, Q1, G1, K1)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;b = </span><span style="color:#e6db74">{</span>b<span style="color:#e6db74">}</span><span style="color:#e6db74">, c = </span><span style="color:#e6db74">{</span>c<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span></code></pre></div><p>求出k</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">770311352827455849356512448287</span>
</span></span><span style="display:flex;"><span>E <span style="color:#f92672">=</span> EllipticCurve(GF(p), [<span style="color:#f92672">-</span><span style="color:#ae81ff">35</span>, <span style="color:#ae81ff">98</span>])
</span></span><span style="display:flex;"><span>G <span style="color:#f92672">=</span> E(<span style="color:#ae81ff">584273268656071313022845392380</span>, <span style="color:#ae81ff">105970580903682721429154563816</span>)
</span></span><span style="display:flex;"><span>P <span style="color:#f92672">=</span> E(<span style="color:#ae81ff">401055814681171318348566474726</span>, <span style="color:#ae81ff">293186309252428491012795616690</span>)
</span></span><span style="display:flex;"><span>k <span style="color:#f92672">=</span> G<span style="color:#f92672">.</span>discrete_log(P)
</span></span><span style="display:flex;"><span>print(k)
</span></span></code></pre></div><p>aes</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> hashlib
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Cipher <span style="color:#f92672">import</span> AES
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.Padding <span style="color:#f92672">import</span> pad, unpad
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>iv <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;bae1b42f174443d009c8d3a1576f07d6&#39;</span>
</span></span><span style="display:flex;"><span>cipher <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ff34da7a65854ed75342fd4ad178bf577bd622df9850a24fd63e1da557b4b8a4&#39;</span>
</span></span><span style="display:flex;"><span>key <span style="color:#f92672">=</span> <span style="color:#ae81ff">2951856998192356</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">AES_encrypt</span>(k):
</span></span><span style="display:flex;"><span>    key <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha256(str(k)<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>digest()[:<span style="color:#ae81ff">16</span>]
</span></span><span style="display:flex;"><span>    iv <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>urandom(<span style="color:#ae81ff">16</span>)
</span></span><span style="display:flex;"><span>    cipher <span style="color:#f92672">=</span> AES<span style="color:#f92672">.</span>new(key, AES<span style="color:#f92672">.</span>MODE_CBC, iv)
</span></span><span style="display:flex;"><span>    encrypted <span style="color:#f92672">=</span> cipher<span style="color:#f92672">.</span>encrypt(pad(FLAG, AES<span style="color:#f92672">.</span>block_size))
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;iv&#34;</span>: iv<span style="color:#f92672">.</span>hex(),
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;cipher&#34;</span>: encrypted<span style="color:#f92672">.</span>hex()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">AES_decrypt</span>(k, iv_hex, cipher_hex):
</span></span><span style="display:flex;"><span>    key <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha256(str(k)<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>digest()[:<span style="color:#ae81ff">16</span>]
</span></span><span style="display:flex;"><span>    iv <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(iv_hex)
</span></span><span style="display:flex;"><span>    cipher <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(cipher_hex)
</span></span><span style="display:flex;"><span>    aes <span style="color:#f92672">=</span> AES<span style="color:#f92672">.</span>new(key, AES<span style="color:#f92672">.</span>MODE_CBC, iv)
</span></span><span style="display:flex;"><span>    decrypted_padded <span style="color:#f92672">=</span> aes<span style="color:#f92672">.</span>decrypt(cipher)
</span></span><span style="display:flex;"><span>    print(decrypted_padded)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        decrypted <span style="color:#f92672">=</span> unpad(decrypted_padded, <span style="color:#ae81ff">16</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">ValueError</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Padding error: </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> decrypted
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>decrypted_message <span style="color:#f92672">=</span> AES_decrypt(key, iv, cipher)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> decrypted_message:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;Decrypted message:&#34;</span>, decrypted_message<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;UTF-8&#39;</span>))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;Decryption failed.&#34;</span>)
</span></span></code></pre></div><p>#RSAloss
##题目</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> gmpy2 <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> getPrime(<span style="color:#ae81ff">100</span>)
</span></span><span style="display:flex;"><span>q <span style="color:#f92672">=</span> getPrime(<span style="color:#ae81ff">100</span>)
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> p <span style="color:#f92672">*</span> q
</span></span><span style="display:flex;"><span>e <span style="color:#f92672">=</span> <span style="color:#ae81ff">65537</span>
</span></span><span style="display:flex;"><span>message <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>m <span style="color:#f92672">=</span> bytes_to_long(message)
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> pow(m, e, n)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;c = </span><span style="color:#e6db74">{</span>c<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;p = </span><span style="color:#e6db74">{</span>p<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;q = </span><span style="color:#e6db74">{</span>q<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>d <span style="color:#f92672">=</span> invert(e,(p<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>(q<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>newm <span style="color:#f92672">=</span> pow(c, d, n)
</span></span><span style="display:flex;"><span>print(long_to_bytes(newm))
</span></span><span style="display:flex;"><span><span style="color:#75715e"># c = 356435791209686635044593929546092486613929446770721636839137</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># p = 898278915648707936019913202333</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># q = 814090608763917394723955024893</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># newm = b&#39;X\xee\x1ey\x88\x01dX\xf6i\x91\x80h\xf4\x1f!\xa7&#34;\x0c\x9a\x06\xc8\x06\x81\x15&#39;</span>
</span></span></code></pre></div><p>##分析
看到newm时第一时间想到了是m &lt; n的情形，然后尝试爆破了一下newm+k*n没出来
然后现在是复现的<del>呜呜呜</del>
其实这个格子和背包密码那个格子基本一样，参考一下就好了</p>
<p>设 pre = b&rsquo;DASCTF{&rsquo;,suf = b&rsquo;}'
newm = c = 256 ^{(le?7)}?pre + 256?m_0 + suf
意识到这个题目满足以下式子</p>
<p>m_0 = {\textstyle \sum_{i = 1}^{le-7-1-1}} 256^i *s_i (mod \quad p)</p>
<p>构造如下一个格子</p>
<p>latex
M0 =
\begin{pmatrix}
1 &amp;   &amp;        &amp;   &amp;   &amp;  256^0   \
&amp; 1 &amp;        &amp;   &amp;   &amp;  256^1    \
&amp;   &amp; \ddots &amp;   &amp;   &amp;  \vdots    \
&amp;   &amp;        &amp; 1 &amp;   &amp;  256^{le-9} \
&amp;   &amp;        &amp;   &amp; 1 &amp;  -m_0        \
&amp;   &amp;        &amp;   &amp;   &amp;  n            \
\end{pmatrix}</p>
<p>然后有如下的式子可以获得我们的目标向量，由于长度le未知所以我们需要进行爆破(爆破这个长度的范围)</p>
<p>latex
(s_0,s_1,\dots ,s_{le-9},1,k) * M = (s_0,s_1,\dots ,s_{le-9},1,0)</p>
<p>这样并没有成功爆破出正确答案，所以考虑进行优化
注意到s_i的范围应该是[48,128],于是令r_i = s_i - 48
对应的修改如下</p>
<p>latex
m_0 = {\textstyle \sum_{i = 1}^{le-7-1-1}} 256^i *(r_i + 48) (mod \quad p)</p>
<p>latex
M1 =
\begin{pmatrix}
1 &amp;   &amp;        &amp;   &amp;   &amp;  256^0   \
&amp; 1 &amp;        &amp;   &amp;   &amp;  256^1    \
&amp;   &amp; \ddots &amp;   &amp;   &amp;  \vdots    \
&amp;   &amp;        &amp; 1 &amp;   &amp;  256^{le-9} \
&amp;   &amp;        &amp;   &amp; 1 &amp;  -(m_0-{\textstyle \sum_{i = 1}^{le-7-1-1}} 256^i *40)        \
&amp;   &amp;        &amp;   &amp;   &amp;  n            \
\end{pmatrix}</p>
<p>这样仍然没有爆破出来于是进行了第二次优化
注意到r_i的范围应该是[0,80]
令t_i = r_i - 40
则t_i 范围[-40,40]</p>
<p>latex
m_0 = {\textstyle \sum_{i = 1}^{le-7-1-1}} 256^i *(t_i + 48 + 40) (mod \quad p)</p>
<p>latex
M2 =
\begin{pmatrix}
1 &amp;   &amp;        &amp;   &amp;   &amp;  256^0   \
&amp; 1 &amp;        &amp;   &amp;   &amp;  256^1    \
&amp;   &amp; \ddots &amp;   &amp;   &amp;  \vdots    \
&amp;   &amp;        &amp; 1 &amp;   &amp;  256^{le-9} \
&amp;   &amp;        &amp;   &amp; 1 &amp;  -(m_0-{\textstyle \sum_{i = 1}^{le-7-1-1}} 256^i * (40 + 48)) \
&amp;   &amp;        &amp;   &amp;   &amp;  n            \
\end{pmatrix}</p>
<p>这样就求解成功了，这个优化是真的长知识了
##exp
是二次优化之后的哈</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">898278915648707936019913202333</span>
</span></span><span style="display:flex;"><span>q1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">814090608763917394723955024893</span>
</span></span><span style="display:flex;"><span>newm <span style="color:#f92672">=</span> bytes_to_long(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;X</span><span style="color:#ae81ff">\xee\x1e</span><span style="color:#e6db74">y</span><span style="color:#ae81ff">\x88\x01</span><span style="color:#e6db74">dX</span><span style="color:#ae81ff">\xf6</span><span style="color:#e6db74">i</span><span style="color:#ae81ff">\x91\x80</span><span style="color:#e6db74">h</span><span style="color:#ae81ff">\xf4\x1f</span><span style="color:#e6db74">!</span><span style="color:#ae81ff">\xa7</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x0c\x9a\x06\xc8\x06\x81\x15</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> p1 <span style="color:#f92672">*</span> q1
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> newm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>prefix <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;DASCTF{&#34;</span>
</span></span><span style="display:flex;"><span>suffix <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;}&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> le <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">33</span>, <span style="color:#ae81ff">40</span>):
</span></span><span style="display:flex;"><span>    length <span style="color:#f92672">=</span> le <span style="color:#f92672">-</span> len(prefix) <span style="color:#f92672">-</span> len(suffix)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#part1 remove prefix and suffix</span>
</span></span><span style="display:flex;"><span>    c <span style="color:#f92672">-=</span> <span style="color:#ae81ff">256</span><span style="color:#f92672">^</span>(len(suffix) <span style="color:#f92672">+</span> length) <span style="color:#f92672">*</span> bytes_to_long(prefix)
</span></span><span style="display:flex;"><span>    c <span style="color:#f92672">-=</span> bytes_to_long(suffix)
</span></span><span style="display:flex;"><span>    c <span style="color:#f92672">=</span> c <span style="color:#f92672">*</span> inverse(<span style="color:#ae81ff">256</span>,p) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    L <span style="color:#f92672">=</span> Matrix(ZZ,length<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>,length<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(length):
</span></span><span style="display:flex;"><span>        L[i,i] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        L[i,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">256</span><span style="color:#f92672">^</span>i
</span></span><span style="display:flex;"><span><span style="color:#75715e">#删除这两行就是M0了</span>
</span></span><span style="display:flex;"><span>        c <span style="color:#f92672">-=</span> <span style="color:#ae81ff">256</span><span style="color:#f92672">^</span>i<span style="color:#f92672">*</span><span style="color:#ae81ff">48</span>
</span></span><span style="display:flex;"><span>        c <span style="color:#f92672">-=</span> <span style="color:#ae81ff">256</span><span style="color:#f92672">^</span>i<span style="color:#f92672">*</span><span style="color:#ae81ff">40</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>    L[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    L[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>c
</span></span><span style="display:flex;"><span>    L[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> p
</span></span><span style="display:flex;"><span>    L[:,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>:] <span style="color:#f92672">*=</span> p
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">=</span> L<span style="color:#f92672">.</span>BKZ()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> res[:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]:
</span></span><span style="display:flex;"><span>        flag0 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;DASCTF{&#34;</span>
</span></span><span style="display:flex;"><span>        flag <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(all(abs(j) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">40</span> <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> i[:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>])):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span>(i[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> i[:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>][::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]:
</span></span><span style="display:flex;"><span>                    flag <span style="color:#f92672">+=</span> chr(<span style="color:#ae81ff">48</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">40</span> <span style="color:#f92672">+</span> j)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">elif</span> i[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>] <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> i[:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>][::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]:
</span></span><span style="display:flex;"><span>                    flag <span style="color:#f92672">+=</span> chr(<span style="color:#ae81ff">48</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">40</span> <span style="color:#f92672">-</span> j)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(flag <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span>):
</span></span><span style="display:flex;"><span>            flag <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39;}&#39;</span>
</span></span><span style="display:flex;"><span>            flag0 <span style="color:#f92672">+=</span> flag
</span></span><span style="display:flex;"><span>            print(flag0)
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">#print(le)</span>
</span></span><span style="display:flex;"><span>    c <span style="color:#f92672">=</span> newm
</span></span><span style="display:flex;"><span><span style="color:#75715e"># DASCTF{o0p5_m3ssaGe_to0_b1g_nv93nd0}</span>
</span></span></code></pre></div><p>#TheoremPlus
##题目</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> gmpy2 <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> secret <span style="color:#f92672">import</span> flag
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">decode_e</span>(e):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> e <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>        mul <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, e):
</span></span><span style="display:flex;"><span>            mul <span style="color:#f92672">*=</span> i
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> e <span style="color:#f92672">-</span> mul <span style="color:#f92672">%</span> e <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            mulmod <span style="color:#f92672">=</span> mul <span style="color:#f92672">%</span> e <span style="color:#f92672">-</span> e
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            mulmod <span style="color:#f92672">=</span> mul <span style="color:#f92672">%</span> e
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> mulmod <span style="color:#f92672">+</span> decode_e(e <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>q <span style="color:#f92672">=</span> getPrime(<span style="color:#ae81ff">1024</span>)
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> next_prime(q)
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> p <span style="color:#f92672">*</span> q
</span></span><span style="display:flex;"><span>phi <span style="color:#f92672">=</span> (p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> (q <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>e <span style="color:#f92672">=</span> abs(decode_e(<span style="color:#ae81ff">703440151</span>))
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> pow(bytes_to_long(flag), e, n)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;n = </span><span style="color:#e6db74">{}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#39;c = </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(n, c))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">n = 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">c = 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span></code></pre></div><p>##分析
首先看到这里</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">decode_e</span>(e):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> e <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>        mul <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, e):
</span></span><span style="display:flex;"><span>            mul <span style="color:#f92672">*=</span> i
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> e <span style="color:#f92672">-</span> mul <span style="color:#f92672">%</span> e <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            mulmod <span style="color:#f92672">=</span> mul <span style="color:#f92672">%</span> e <span style="color:#f92672">-</span> e
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            mulmod <span style="color:#f92672">=</span> mul <span style="color:#f92672">%</span> e
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> mulmod <span style="color:#f92672">+</span> decode_e(e <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>
</span></span></code></pre></div><p>注意到这里有一个e - mul % e ?= 1 的判断
而mul的值是(e-1)!
所以这个式子就符合了威尔逊定理
只要e是素数就为1
否则为0
为0的原因:如果e不是素数那就一定是A1<em>X1+……+An</em>Xn的格式，且这{A1,……,An}{X1,……Xn}都 &lt;= e-1
可以被(e-1)!整除，所以必然为0
也就是说这道题目生成的e就是小于输入的e的素数的个数，使用prime_pi即可得到e,然后进行费马分解就可以得到flag
##exp</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> gmpy2 <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#获取e</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;sage
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">e = 703440151
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">a = prime_pi(e)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">e = a - 2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#为什么减掉2呢?首先这里面是不包括这个初始e本身的(没错e是素数)，所以-1,其次4也是一个特殊值,再-1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>e <span style="color:#f92672">=</span> <span style="color:#ae81ff">36421873</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">18770575776346636857117989716700159556553308603827318013591587255198383129370907809760732011993542700529211200756354110539398800399971400004000898098091275284235225898698802555566416862975758535452624647017057286675078425814784682675012671384340267087604803050995107534481069279281213277371234272710195280647747033302773076094600917583038429969629948198841325080329081838681126456119415461246986745162687569680825296434756908111148165787768172000131704615314046005916223370429567142992192702888820837032850104701948658736010527261246199512595520995042205818856177310544178940343722756848658912946025299687434514029951</span>
</span></span><span style="display:flex;"><span>c <span style="color:#f92672">=</span> <span style="color:#ae81ff">2587907790257921446754254335909686808394701314827194535473852919883847207482301560195700622542784316421967768148156146355099210400053281966782598551680260513547233270646414440776109941248869185612357797869860293880114609649325409637239631730174236109860697072051436591823617268725493768867776466173052640366393488873505207198770497373345116165334779381031712832136682178364090547875479645094274237460342318587832274304777193468833278816459344132231018703578274192000016560653148923056635076144189403004763127515475672112627790796376564776321840115465990308933303392198690356639928538984862967102082126458529748355566</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tmp <span style="color:#f92672">=</span> gmpy2<span style="color:#f92672">.</span>iroot(n,<span style="color:#ae81ff">2</span>)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> gmpy2<span style="color:#f92672">.</span>next_prime(tmp)
</span></span><span style="display:flex;"><span>q <span style="color:#f92672">=</span> n<span style="color:#f92672">//</span>p
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;p =&#34;</span>,p)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;q =&#34;</span>,q)
</span></span><span style="display:flex;"><span>phi <span style="color:#f92672">=</span> (p<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>(q<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>d <span style="color:#f92672">=</span> invert(e,phi)
</span></span><span style="display:flex;"><span>m <span style="color:#f92672">=</span> pow(c,d,n)
</span></span><span style="display:flex;"><span>print(long_to_bytes(m))
</span></span></code></pre></div><p>嗯，就这样</p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
